# yaml-language-server: $schema=https://json.schemastore.org/github-workflow.json
name: CI

on:
  push:
    branches: [main]
  workflow_dispatch:

permissions:
  contents: read

jobs:
  python-ci:
    name: Python CI
    uses: stranske/Workflows/.github/workflows/reusable-10-ci-python.yml@07c3a6ce10ff00953624e9f0705c44190ec7b33c
    with:
      python-versions: '["3.11", "3.12"]'
      coverage-min: "80"
    secrets: inherit

  gate:
    name: Gate
    runs-on: ubuntu-latest
    needs: [python-ci]
    if: always()
    steps:
      - name: Check job results
        run: |
          echo "python-ci: ${{ needs.python-ci.result }}"

      - name: Fail if any required job failed
        if: contains(needs.*.result, 'failure') || contains(needs.*.result, 'cancelled')
        run: |
          echo "::error::One or more required jobs failed or were cancelled"
          exit 1

      - name: All checks passed
        run: echo "All required checks passed"
